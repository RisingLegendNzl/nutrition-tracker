<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Nutrify</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <header class="app-header">
    <h1>Nutrify</h1>
    <nav class="tabs">
      <button id="tabDiet" class="tab active" aria-controls="dietPage">Diet</button>
      <button id="tabSupps" class="tab" aria-controls="suppsPage">Sup-Stack</button>
    </nav>
    <div id="daySwitcher" class="day-switcher">
      <button id="prevDay" class="ghost" aria-label="Previous day">Prev</button>
      <div id="dayName" class="day-name">Monday</div>
      <button id="nextDay" class="ghost" aria-label="Next day">Next</button>
    </div>
  </header>

  <!-- DIET PAGE -->
  <main id="dietPage">
    <section class="card">
      <h2 class="section-title">Meals</h2>
      <div id="meals"></div>
    </section>
    <section class="card">
      <h2 class="section-title">Remaining Today</h2>
      <div id="macroSummary" class="summary-row"></div>
      <div id="bars"></div>
    </section>
  </main>

  <!-- SUPPS PAGE -->
  <main id="suppsPage" class="hidden">
    <section class="card">
      <h2 class="section-title">Supplements</h2>
      <div id="suppList"></div>
      <div class="supp-actions">
        <button id="restoreDefaults" class="ghost small">Restore defaults</button>
      </div>
    </section>

    <!-- Add/Edit Sheet -->
    <div id="sheet" class="sheet hidden" role="dialog" aria-modal="true" aria-labelledby="sheetTitle">
      <div class="sheet-card">
        <h3 id="sheetTitle">Add supplement</h3>
        <form id="suppForm">
          <label class="field">
            <span>Name</span>
            <input id="fName" type="text" placeholder="e.g., Zinc"/>
          </label>
          <!-- typeahead dropdown will be injected here -->
          <label class="field">
            <span>Dosage</span>
            <input id="fDose" type="text" placeholder="e.g., 25 mg"/>
          </label>
          <label class="field">
            <span>Timing</span>
            <input id="fTiming" type="text" placeholder="e.g., With breakfast"/>
          </label>
          <label class="field">
            <span>Pairs best with</span>
            <input id="fPairs" type="text" placeholder="e.g., Fat-containing meal"/>
          </label>
          <label class="field">
            <span>Notes</span>
            <textarea id="fNotes" rows="3" placeholder="e.g., Keep 2h away from iron"></textarea>
          </label>
          <div class="sheet-row">
            <button type="button" id="cancelSheet" class="ghost">Cancel</button>
            <button type="submit" id="saveSheet" class="primary">Save</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Floating Add Button -->
    <button id="addSupp" class="fab" aria-label="Add supplement">Add</button>

    <!-- Snackbar -->
    <div id="snackbar" class="snackbar hidden">
      <span id="snackMsg"></span>
      <button id="undoBtn" class="link">Undo</button>
    </div>
  </main>

  <footer class="app-footer">
    <div class="tip">Diet: toggle meals to update remaining nutrients. Sup-Stack: track “taken today” and manage your list.</div>
  </footer>

  <script src="data.js"></script>
  <script>
    /* === Global state, DOM refs, Diet + Supp logic from earlier === */
    /* ... (unchanged code from your working version, including setTab, renderDiet, etc.) ... */

    // === TYPEAHEAD HOOKUP ===
    const nameFieldWrapper = document.querySelector('#fName').parentElement;
    nameFieldWrapper.style.position = 'relative';
    const ta = document.createElement('div');
    ta.id = 'typeahead';
    ta.className = 'typeahead hidden';
    nameFieldWrapper.appendChild(ta);

    function resolveCanonicalName(inputStr){
      const s = inputStr.trim().toLowerCase();
      if (!s) return null;
      if (ALIAS_TO_CANON[s]) return ALIAS_TO_CANON[s];
      const hits = Object.keys(ALIAS_TO_CANON).filter(k => k.includes(s));
      if (hits.length) return ALIAS_TO_CANON[hits[0]];
      return null;
    }

    function suggestionsFor(inputStr, limit=6){
      const s = inputStr.trim().toLowerCase();
      if (!s) return [];
      const uniq = new Set();
      const results = [];
      Object.keys(ALIAS_TO_CANON).forEach(key=>{
        if (key.startsWith(s)){
          const canon = ALIAS_TO_CANON[key];
          if (!uniq.has(canon)){ uniq.add(canon); results.push(canon); }
        }
      });
      Object.keys(ALIAS_TO_CANON).forEach(key=>{
        if (results.length>=limit) return;
        if (key.includes(s)){
          const canon = ALIAS_TO_CANON[key];
          if (!uniq.has(canon)){ uniq.add(canon); results.push(canon); }
        }
      });
      return results.slice(0, limit);
    }

    function showTypeahead(list){
      if (!list.length){ ta.classList.add('hidden'); ta.innerHTML=''; return; }
      ta.innerHTML = list.map(canon => `<button type="button" data-canon="${canon}">${canon}</button>`).join('');
      ta.classList.remove('hidden');
      [...ta.querySelectorAll('button')].forEach(btn=>{
        btn.onclick = ()=>{
          const canon = btn.getAttribute('data-canon');
          fName.value = canon;
          const sug = SMART_SUGGESTIONS[canon];
          if (sug){
            if (!fDose.value)   fDose.value   = sug.dose || '';
            if (!fTiming.value) fTiming.value = sug.timing || '';
            if (!fPairs.value)  fPairs.value  = sug.pairs || '';
            if (!fNotes.value)  fNotes.value  = sug.notes || '';
          }
          ta.classList.add('hidden'); ta.innerHTML='';
        };
      });
    }

    fName.addEventListener('input', ()=>{
      const list = suggestionsFor(fName.value);
      showTypeahead(list);
    });
    fName.addEventListener('blur', ()=> setTimeout(()=>{ ta.classList.add('hidden'); }, 150));

    // Override suggestFor
    const OLD_suggestFor = suggestFor;
    function suggestFor(name){
      const canon = resolveCanonicalName(name);
      if (canon && SMART_SUGGESTIONS[canon]) return { ...SMART_SUGGESTIONS[canon] };
      return OLD_suggestFor(name);
    }

    // init() call remains same
  </script>
</body>
</html>