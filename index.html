<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nutrify</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="app-header">
    <h1>Nutrify</h1>
    <div class="day-switcher">
      <button id="prevDay" class="ghost" aria-label="Previous day">Prev</button>
      <div id="dayName" class="day-name">Monday</div>
      <button id="nextDay" class="ghost" aria-label="Next day">Next</button>
    </div>
  </header>

  <main id="app">
    <section class="card">
      <h2 class="section-title">Meals</h2>
      <div id="meals"></div>
    </section>

    <section class="card">
      <h2 class="section-title">Remaining Today</h2>
      <div id="macroSummary" class="summary-row"></div>
      <div id="bars"></div>
    </section>
  </main>

  <footer class="app-footer">
    <div class="tip">Toggle meals as you eat. Tap a meal row to view ingredients.</div>
  </footer>

  <script src="data.js"></script>
  <script>
    const goals = {
      calories: 3500,
      protein: 200,
      fibre: 30,
      iron: 8,
      zinc: 14,
      calcium: 1000,
      vitaminC: 45,
      folate: 400,
      potassium: 3800
    };

    let dayIndex = 0;
    const days = Object.keys(mealPlan);
    const toggles = {};
    const openMeals = {};

    const dayNameEl = document.getElementById("dayName");
    const mealsEl = document.getElementById("meals");
    const barsEl = document.getElementById("bars");
    const macroSummaryEl = document.getElementById("macroSummary");
    const prevBtn = document.getElementById("prevDay");
    const nextBtn = document.getElementById("nextDay");

    prevBtn.addEventListener("click", () => { if (dayIndex > 0) { dayIndex--; render(); } });
    nextBtn.addEventListener("click", () => { if (dayIndex < days.length - 1) { dayIndex++; render(); } });

    function render() {
      const day = days[dayIndex];
      const meals = mealPlan[day];

      dayNameEl.textContent = day;
      prevBtn.disabled = dayIndex === 0;
      nextBtn.disabled = dayIndex === days.length - 1;

      mealsEl.innerHTML = "";
      Object.entries(meals).forEach(([mealName, mealData]) => {
        const card = document.createElement("div");
        card.className = "meal-row";
        if (openMeals[day]?.[mealName]) card.classList.add("open");

        // clickable row (everything except toggle)
        const rowBtn = document.createElement("div");
        rowBtn.className = "meal-title";
        rowBtn.innerHTML = `
          <div class="title-line">
            <span class="chev" aria-hidden="true"></span>
            <span class="meal-name">${mealName}</span>
          </div>
          <div class="meal-macros">${mealData.calories} kcal • ${mealData.protein} g protein • ${mealData.fibre} g fibre</div>
        `;
        rowBtn.addEventListener("click", () => {
          openMeals[day] = openMeals[day] || {};
          openMeals[day][mealName] = !openMeals[day][mealName];
          render();
        });

        // toggle
        const toggleWrap = document.createElement("label");
        toggleWrap.className = "switch";
        const input = document.createElement("input");
        input.type = "checkbox";
        input.checked = toggles[day]?.[mealName] || false;
        const slider = document.createElement("span");
        slider.className = "slider";

        // stop toggle clicks from expanding
        toggleWrap.addEventListener("click", (e) => e.stopPropagation());
        input.addEventListener("change", () => {
          toggles[day] = toggles[day] || {};
          toggles[day][mealName] = input.checked;
          updateTotals();
        });

        toggleWrap.appendChild(input);
        toggleWrap.appendChild(slider);

        const top = document.createElement("div");
        top.className = "meal-top";
        top.appendChild(rowBtn);
        top.appendChild(toggleWrap);

        // ingredients
        const details = document.createElement("div");
        details.className = "ingredients";
        if (mealData.ingredients?.length) {
          const list = document.createElement("ul");
          mealData.ingredients.forEach(item => {
            const li = document.createElement("li");
            li.textContent = item;
            list.appendChild(li);
          });
          details.appendChild(list);
        }

        card.appendChild(top);
        card.appendChild(details);
        mealsEl.appendChild(card);
      });

      updateTotals();
    }

    function updateTotals() {
      const day = days[dayIndex];
      const meals = mealPlan[day];
      const totals = Object.keys(goals).reduce((a,k)=>(a[k]=0,a),{});

      Object.entries(meals).forEach(([mealName, meal]) => {
        if (!toggles[day]?.[mealName]) {
          for (const k in goals) totals[k] += meal[k] || 0;
        }
      });

      macroSummaryEl.innerHTML = `
        <div class="pill"><span>Calories</span><strong>${Math.round(totals.calories)}</strong></div>
        <div class="pill"><span>Protein</span><strong>${Math.round(totals.protein)} g</strong></div>
        <div class="pill"><span>Fibre</span><strong>${Math.round(totals.fibre)} g</strong></div>
      `;

      barsEl.innerHTML = "";
      Object.entries(goals).forEach(([k, goal]) => {
        const val = totals[k];
        const pct = Math.min(100, (val/goal)*100);
        const row = document.createElement("div");
        row.className = "bar-row";
        row.innerHTML = `
          <div class="bar-label">
            <span>${labelPretty(k)}</span>
            <span class="bar-value">${formatValue(k,val)} / ${formatValue(k,goal)}</span>
          </div>
          <div class="bar-outer"><div class="bar-inner" style="width:${pct}%"></div></div>
        `;
        barsEl.appendChild(row);
      });
    }

    function labelPretty(key){
      return {
        calories:"Calories",protein:"Protein",fibre:"Fibre",iron:"Iron",zinc:"Zinc",
        calcium:"Calcium",vitaminC:"Vitamin C",folate:"Folate",potassium:"Potassium"
      }[key]||key;
    }

    function formatValue(key,v){
      if(key==="calories")return Math.round(v)+" kcal";
      if(["protein","fibre"].includes(key))return Math.round(v)+" g";
      if(["iron","zinc"].includes(key))return v.toFixed(1)+" mg";
      if(["calcium","potassium"].includes(key))return Math.round(v)+" mg";
      if(key==="vitaminC")return Math.round(v)+" mg";
      if(key==="folate")return Math.round(v)+" µg";
      return v;
    }

    render();
  </script>
</body>
</html>